<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Let’s Encrypt improves how we manage OCSP responses -  Let&#39;s Encrypt</title>
    <meta name="description" content="Let&amp;rsquo;s Encrypt has improved how we manage Online Certificate Status Protocol (OCSP) responses by deploying Redis and generating responses on-demand rather than pre-generating them, making us more reliable than ever.
About OCSP Responses OCSP is used to communicate the revocation status of TLS certificates. When an ACME agent signs a request to revoke a certificate, our Let&amp;rsquo;s Encrypt Certificate Authority (CA) verifies whether or not the request is authorized and if it is, we begin publishing a &amp;lsquo;revoked&amp;rsquo; OCSP response for that certificate.">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@letsencrypt">
    <meta name="twitter:title" content="Let’s Encrypt improves how we manage OCSP responses">
    <meta name="twitter:url" content="https://letsencrypt.org/2022/12/15/ocspcaching.html">
    <meta name="twitter:description" content="Let&amp;rsquo;s Encrypt has improved how we manage Online Certificate Status Protocol (OCSP) responses by deploying Redis and generating responses on-demand rather than pre-generating them, making us more reliable than ever.
About OCSP Responses OCSP is used to communicate the revocation status of TLS certificates. When an ACME agent signs a request to revoke a certificate, our Let&amp;rsquo;s Encrypt Certificate Authority (CA) verifies whether or not the request is authorized and if it is, we begin publishing a &amp;lsquo;revoked&amp;rsquo; OCSP response for that certificate.">
    <meta name="twitter:image:src" content="https://letsencrypt.org/images/le-logo-twitter-noalpha.png">
    <meta name="og:image" content="https://letsencrypt.org/images/LetsEncrypt-SocialShare.png">

    
    <link rel="stylesheet" href="/css/main.min.6791249091d19b45fdcb90a60bdc1d673e0fa8014336e38e91d9017427824807933b14f5d5af8403308998662afcdf07b5be942bb9087d7cfbfdb5da709822a5.css" integrity="sha512-Z5EkkJHRm0X9y5CmC9wdZz4PqAFDNuOOkdkBdCeCSAeTOxT11a&#43;EAzCJmGYq/N8Htb6UK7kIfXz7/bXacJgipQ==">

    <link rel="stylesheet" href="/fontawesome-free-5.12.1-web/css/all.min.css" />
    
    <link rel="canonical" href="/2022/12/15/ocspcaching.html">
    
    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="Let&#39;s Encrypt Blog Feed" />
    
    
</head>

  <body>
    
<header class="site-header">
  <a id="skiplink" href="#main-content">Skip navigation links</a>
  <div class="wrapper">
    <a class="site-title" href="/"><img src="/images/letsencrypt-logo-horizontal.svg" alt="Let's Encrypt"></a>

    <span id="menuIcon">
      <i class="fas fa-bars"></i>
    </span>
    <nav class="site-nav" id="menu">
      <div class="pure-menu pure-menu-horizontal custom-can-transform">
        <ul class="pure-menu-list">
          
          <li class="pure-menu-item">
            <a href="/docs/" class="pure-menu-link" tabindex="0">Documentation</a>
            
          </li>
          
          <li class="pure-menu-item">
            <a href="https://community.letsencrypt.org/" class="pure-menu-link" tabindex="0">Get Help</a>
            
          </li>
          
          <li class="pure-menu-item pure-menu-has-children">
            <a href="#" class="pure-menu-link" tabindex="0">Donate</a>
            
            <ul class="pure-menu-children">
              
              <li class="pure-menu-item">
                <a href="/donate/" class="pure-menu-link">Make a Donation</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="https://www.abetterinternet.org/sponsor/" class="pure-menu-link">Become a Sponsor</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/sponsors/" class="pure-menu-link">Current Sponsors and Funders</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/getinvolved/" class="pure-menu-link">Get Involved</a>
              </li>
              
            </ul>
            
          </li>
          
          <li class="pure-menu-item pure-menu-has-children">
            <a href="#" class="pure-menu-link" tabindex="0">About Us</a>
            
            <ul class="pure-menu-children">
              
              <li class="pure-menu-item">
                <a href="/about/" class="pure-menu-link">Let&#39;s Encrypt</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="https://www.abetterinternet.org/about/" class="pure-menu-link">Internet Security Research Group (ISRG)</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/docs/dst-root-ca-x3-expiration-september-2021/" class="pure-menu-link">DST Root CA X3 Expiration (September 2021)</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/docs/faq/" class="pure-menu-link">Frequently Asked Questions (FAQ)</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/repository/" class="pure-menu-link">Policy and Legal Repository</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="https://letsencrypt.status.io/" class="pure-menu-link">Service Status</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/stats/" class="pure-menu-link">Statistics</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="https://www.abetterinternet.org/careers/" class="pure-menu-link">Careers</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/contact/" class="pure-menu-link">Contact</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/blog/" class="pure-menu-link">Blog</a>
              </li>
              
            </ul>
            
          </li>
          
          
          
          
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
          
          
          <li class="pure-menu-item pure-menu-has-children">
            <a href="#" class="pure-menu-link" tabindex="0">Languages <img src="/images/language-icon128px-black.png" class="inline-icon" alt="" aria-hidden="true"></a>
            <ul class="pure-menu-children menu-for-languages">
              
              
              <li class="pure-menu-item">
                <a href="/" lang="en-US" hreflang="en-US" class="pure-menu-link">✓ English</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/da/" lang="da" hreflang="da" class="pure-menu-link">Dansk</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/de/" lang="de-DE" hreflang="de-DE" class="pure-menu-link">Deutsch</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/es/" lang="es-US" hreflang="es-US" class="pure-menu-link">Español</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/fi/" lang="fi" hreflang="fi" class="pure-menu-link">Suomi</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/fr/" lang="fr-FR" hreflang="fr-FR" class="pure-menu-link">Français</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/he/" lang="he" hreflang="he" class="pure-menu-link">עברית</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/hu/" lang="hu" hreflang="hu" class="pure-menu-link">Hungarian</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/id/" lang="id-ID" hreflang="id-ID" class="pure-menu-link">Bahasa Indonesia</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/it/" lang="it-IT" hreflang="it-IT" class="pure-menu-link">Italiano</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/ja/" lang="ja" hreflang="ja" class="pure-menu-link">日本語</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/ko/" lang="ko-KR" hreflang="ko-KR" class="pure-menu-link">한국어</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/pt-br/" lang="pt-BR" hreflang="pt-BR" class="pure-menu-link">Português do Brasil</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/ru/" lang="ru-RU" hreflang="ru-RU" class="pure-menu-link">Русский</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/si/" lang="si" hreflang="si" class="pure-menu-link">සිංහල</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/sr/" lang="sr" hreflang="sr" class="pure-menu-link">Srpski</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/sv/" lang="sv" hreflang="sv" class="pure-menu-link">Svenska</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/uk/" lang="uk-UA" hreflang="uk-UA" class="pure-menu-link">Українська</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/vi/" lang="vi-VN" hreflang="vi-VN" class="pure-menu-link">Tiếng Việt</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/zh-cn/" lang="zh-Hans-CN" hreflang="zh-Hans-CN" class="pure-menu-link">简体中文</a>
              </li>
              
              
              <li class="pure-menu-item">
                <a href="/zh-tw/" lang="zh-Hant-TW" hreflang="zh-Hant-TW" class="pure-menu-link">繁體中文</a>
              </li>
              
            </ul>
          </li>
          
        </ul>
      </div>
    </nav>
  </div>
</header>
<div id="site-banner">
  <a href="https://abetterinternet.org/tenth-anniversary">ISRG celebrates 10 years of helping build a brighter Internet →</a>
</div>
<div id="main-content"></div>


    
    <div class="page-content">
      <div class="wrapper">
        
<div class="post">
	<header class="post-header">
		<h1 class="post-title">Let’s Encrypt improves how we manage OCSP responses</h1>
		<p class="post-meta">Dec 15, 2022 • Kiel Christofferson</p>
	</header>
	<article class="post-content">
		<p>Let&rsquo;s Encrypt has improved how we manage Online Certificate Status Protocol (OCSP) responses by deploying Redis and generating responses on-demand rather than pre-generating them, making us more reliable than ever.</p>
<h2 id="about-ocsp-responses">About OCSP Responses</h2>
<p>OCSP is used to communicate the revocation status of TLS certificates. When an ACME agent signs a request to revoke a certificate, our Let&rsquo;s Encrypt Certificate Authority (CA) verifies whether or not the request is authorized and if it is, we begin publishing a &lsquo;revoked&rsquo; OCSP response for that certificate. Each time a relying party, such as a browser, visits a domain with a Let&rsquo;s Encrypt certificate, they can request information about whether the certificate has been revoked and we serve a reply containing &lsquo;good&rsquo; or &lsquo;revoked&rsquo;, signed by our CA, which we call an OCSP response.</p>
<h2 id="an-enormous-ocsp-response-load-100-000-every-second">An Enormous OCSP Response Load: 100,000 Every Second</h2>
<p>Let&rsquo;s Encrypt currently serves over <a href="https://letsencrypt.org/stats/">300 million domains</a>, which means we receive an enormous number of certificate revocation status requests &mdash; fielding around 100,000 OCSP responses <em>every second!</em></p>
<p>Normally 98-99% of our OCSP responses are handled by our Content Delivery Network (CDN). But there are times when our CDN has an issue resulting in Let&rsquo;s Encrypt being required to directly accept a larger number of requests. Historically, we could effectively respond to a maximum of 6% of our OCSP response traffic on our own. Should the need arise for us to accept much higher than that, some of our systems might begin to take too long to return results, return significant numbers of errors, or even stop accepting new requests. Not an ideal situation for us, or the Internet.</p>
<p>Our inability to serve OCSP responses during an issue with one of our CDNs could result in a slowdown in users' browsing speed or not being able to connect to a website &mdash; or worse, Internet users unintentionally visiting domains for which a certificate has been revoked. Browsers react differently to unresponsive OCSP, but one thing was clear, our systems needed to handle these occasions much better.</p>
<h2 id="increasing-our-reliability">Increasing our Reliability</h2>
<p>After working on this throughout most of 2022, our engineers have dramatically improved our ability to independently serve OCSP responses. We did that by deploying Redis as an in-memory caching layer that helps protect our database by absorbing traffic spikes, whether due to CDN issues or our own actions, such as CDN cache clearing.</p>
<h2 id="pivot-in-design">Pivot in Design</h2>
<p>Our team developed a system architecture design to organize/change all of the various interconnected systems needed to make Redis trusted to serve our OCSP responses. Amidst the fervor of developing this design, our engineers identified a resource we could depend upon more heavily to simplify the overall architecture and still realize incredible reliability gains. Rather than pre-signing OCSP status responses at regular intervals, storing the results in a relational database, and asking Redis to keep copies&mdash;we could keep simple but authoritative certificate status information in our database. We could then leverage fast, concurrent signing power from our HSMs to Just-in-Time sign a fresh OCSP response, cache it in Redis, and return it to the requester. Thanks to this, the demands on the relational database became much lighter (especially total table-writes and write-contention), the speed was impressive, and Redis wasn&rsquo;t holding anything that couldn&rsquo;t be (very very quickly) regenerated.</p>
<h2 id="testing-our-systems">Testing our Systems</h2>
<p>The first test was to directly accept 1/16 of the requests by dropping a segment of our CDN cache. In that initial test we handled ~12,500 requests per second. Successive tests ratcheted up to 1/8th CDN cache drop, then 1/4th, then 1/2, then a 100% cache drop. With each ratcheting up of the test load we were able to monitor and glean insights as to how our deployment could handle the traffic. In the final test of 100% of requests, our systems remained responsive. This means that if we experience a spike in the number of OCSP responses we need to accept moving forward, we are equipped to handle them, dramatically reducing the risks to Internet users.</p>
<h2 id="supporting-let-s-encrypt">Supporting Let&rsquo;s Encrypt</h2>
<p>As a project of the <a href="https://abetterinternet.org/">Internet Security Research Group</a> (ISRG), 100% of our funding comes from contributions from our community of users and supporters. We depend on their support in order to provide our public benefit services. If your company or organization would like to sponsor Let&rsquo;s Encrypt please email us at <a href="mailto:sponsor@letsencrypt.org">sponsor@letsencrypt.org</a>. If you can support us with a <a href="https://letsencrypt.org/donate/">donation</a>, we ask that you make an individual contribution.</p>

	</article>
</div>

      </div>
    </div>
    
<div class="donate-footer">
  <div class="wrapper text-center">
    <h2>Support a more secure and privacy-respecting Web.</h2>
    <div class="buttons">
      <a class="accent" href="/donate/">Donate</a>
    </div>
  </div>
</div>



<footer class="site-footer">

  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-2">
        <p>  Let's Encrypt is a free, automated, and open certificate
  authority brought to you by the nonprofit <a href="https://www.abetterinternet.org/">Internet Security Research Group (ISRG)</a>.
</p>
        <p>
          <span itemscope itemtype="http://schema.org/PostalAddress">
            <span itemprop="streetAddress">548 Market St, PMB 77519</span>,
            <span itemprop="addressLocality">San Francisco</span>,
            <span itemprop="addressRegion">CA</span>
            <span itemprop="postalCode">94104-5401</span>,
            <span itemprop="addressCountry">USA</span>
          </span>
        </p>
        <p>Send all mail or inquiries to:</p>
        <p>
          <span itemscope itemtype="http://schema.org/PostalAddress">
            <span itemprop="streetAddress">PO Box 18666</span>,
            <span itemprop="addressLocality">Minneapolis</span>,
            <span itemprop="addressRegion">MN</span>
            <span itemprop="postalCode">55418-0666</span>,
            <span itemprop="addressCountry">USA</span>
          </span>
        </p>
      </div>

      <div class="footer-col  footer-col-1">
        <ul class="social-media-list">
          
          <li>
            <i class="fab fa-github" aria-hidden="true"></i>
            <a href="https://github.com/letsencrypt">
              <span class="username">GitHub</span>
            </a>
          </li>
          

          
          <li>
            <i class="fab fa-twitter" aria-hidden="true"></i>
            <a href="https://twitter.com/letsencrypt">
              <span class="username">Twitter</span>
            </a>
          </li>
         
          
          <li>
            <i class="fab fa-mastodon" aria-hidden="true"></i>
            <a rel="me" href="https://infosec.exchange/@letsencrypt">
              <span class="username">Mastodon</span>
            </a>
          </li>
         
        </ul>
        View our <a href="/privacy/">privacy policy</a>.<br>
View our <a href="https://www.abetterinternet.org/trademarks">trademark policy</a>.

      </div>

      <div class="footer-col footer-newsletter-col  footer-col-3">
        <h6>Subscribe to our Newsletter</h6>
        <iframe src="https://outreach.abetterinternet.org/l/1011011/2023-02-16/6l51" height="200" style="width: 100%; border: 0"></iframe>
      </div>
    </div>

  </div>

</footer>



<script src="/js/main.9c0b9add2dc0db21de0f695103830dbde01e31d77fa9a2db9ac3c1b9e09e4806f2e0d9a7281b06461b2e162a3560c605b038169b42ff376b4cd28cc71203c8f0.js" integrity="sha512-nAua3S3A2yHeD2lRA4MNveAeMdd/qaLbmsPBueCeSAby4NmnKBsGRhsuFio1YMYFsDgWm0L/N2tM0ozHEgPI8A=="></script>

  </body>
</html>
